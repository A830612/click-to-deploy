apiVersion: app.k8s.io/v1beta1
kind: Application
metadata:
  name: "{{ .Release.Name }}"
  annotations:
    kubernetes-engine.cloud.google.com/icon: >-
      data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA1MTAgMTM0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS40MTQyMTsiPgogICAgPGcgaWQ9IkNhbHF1ZSAxIiB0cmFuc2Zvcm09Im1hdHJpeCg0LjE2NjY3LDAsMCw0LjE2NjY3LC0xOTguNzQ5LC0zNzQuNTQzKSI+CiAgICAgICAgPHBhdGggZD0iTTExMS45MDUsMTE0LjE2OEMxMDkuOTMzLDExNS41MDggMTA3LjI0LDExNC45OTQgMTA1Ljg5OSwxMTMuMDIyQzEwNC41NTgsMTExLjA1IDEwNS4wNzMsMTA4LjM1NiAxMDcuMDQ1LDEwNy4wMTNDMTA5LjAxNiwxMDUuNjczIDExMS43MSwxMDYuMTg4IDExMy4wNTEsMTA4LjE2QzExNC4zOTMsMTEwLjEzMSAxMTMuODc5LDExMi44MjYgMTExLjkwNSwxMTQuMTY4TTExNC41ODEsMTA3LjEyQzExMi42NjYsMTA0LjI5OCAxMDguODI0LDEwMy41NjggMTA2LjAwNSwxMDUuNDg1QzEwMy4xODQsMTA3LjQwMiAxMDIuNDUyLDExMS4yNDMgMTA0LjM3LDExNC4wNjJDMTA2LjA2NiwxMTYuNTYgMTA5LjI2OSwxMTcuNDE2IDExMS45MzcsMTE2LjI1M0wxMTQuMzI2LDEyMC4xMzNMMTE2LjIyMiwxMTguODQ1TDExMy44MzQsMTE0Ljk2NUMxMTUuODk4LDExMi45MTIgMTE2LjI4LDEwOS42MTUgMTE0LjU4MSwxMDcuMTIiIHN0eWxlPSJmaWxsOnJnYig3LDcsNyk7Ii8+CiAgICAgICAgPHBhdGggZD0iTTE2NS4zMDUsMTE2LjM5OEwxNjMuODI5LDExNi4zOThDMTYzLjgyOSwxMDQuNTA5IDE1NC4wMTksOTQuODM3IDE0MS45NjIsOTQuODM3TDE0MS45NjIsOTMuMzYxQzE1NC44MzQsOTMuMzYxIDE2NS4zMDUsMTAzLjY5MyAxNjUuMzA1LDExNi4zOTgiIHN0eWxlPSJmaWxsOnJnYig3MywxNTYsMjEwKTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICA8cGF0aCBkPSJNMTY2LjMyNSwxMDguNDY4QzE2NC41NTQsMTAxLjAxIDE1OC41MSw5NC43ODUgMTUwLjkzMiw5Mi42MDlMMTUxLjI3Miw5MS40MjZDMTU5LjI3LDkzLjcyMyAxNjUuNjQ5LDEwMC4yOTkgMTY3LjUyMSwxMDguMTgzTDE2Ni4zMjUsMTA4LjQ2OFoiIHN0eWxlPSJmaWxsOnJnYig3MiwxNTYsMjEwKTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICA8cGF0aCBkPSJNMTY3Ljk4NywxMDEuNDY5QzE2Ni4xNjEsOTcuNDg3IDE2My4wNDcsOTQuMDE0IDE1OS4yMjYsOTEuNjkxTDE1OS43MzcsOTAuODVDMTYzLjcyNyw5My4yNzYgMTY2Ljk3Miw5Ni44OTkgMTY4Ljg4LDEwMS4wNThMMTY3Ljk4NywxMDEuNDY5WiIgc3R5bGU9ImZpbGw6cmdiKDcyLDE1NiwyMTApO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMjQsMCwwLDAuMjQsNy40NDgxNiwtOS4xMTE3NSkiPgogICAgICAgICAgICA8cGF0aCBkPSJNMTcyLjAxNSw1MjAuMzM0QzE3NS43MTUsNTIyLjMzNCAxODEuNDE1LDUyMy44MzQgMTg3LjgxNSw1MjMuODM0QzIwMS44MTUsNTIzLjgzNCAyMDguOTE1LDUxNy4xMzQgMjA4LjkxNSw1MDcuOTM0QzIwOC44MTUsNTAwLjgzNCAyMDUuMDE1LDQ5Ni4xMzQgMTk1LjcxNSw0OTIuOTM0QzE4OS43MTUsNDkwLjkzNCAxODcuODE1LDQ4OS42MzQgMTg3LjgxNSw0ODcuMzM0QzE4Ny44MTUsNDg0LjkzNCAxODkuOTE1LDQ4My40MzQgMTkzLjYxNSw0ODMuNDM0QzE5Ny43MTUsNDgzLjQzNCAyMDIuMDE1LDQ4NS4wMzQgMjA0LjIxNSw0ODYuMTM0TDIwNi44MTUsNDc1LjczNEMyMDMuODE1LDQ3NC4yMzQgMTk4LjgxNSw0NzIuODM0IDE5My4xMTUsNDcyLjgzNEMxODEuMDE1LDQ3Mi44MzQgMTczLjIxNSw0NzkuNzM0IDE3My4yMTUsNDg4LjkzNEMxNzMuMTE1LDQ5NC42MzQgMTc3LjAxNSw1MDAuMTM0IDE4Ny4yMTUsNTAzLjUzNEMxOTIuODE1LDUwNS4zMzQgMTk0LjMxNSw1MDYuNjM0IDE5NC4zMTUsNTA5LjEzNEMxOTQuMzE1LDUxMS42MzQgMTkyLjQxNSw1MTMuMTM0IDE4Ny44MTUsNTEzLjEzNEMxODMuMzE1LDUxMy4xMzQgMTc3LjUxNSw1MTEuMjM0IDE3NC43MTUsNTA5LjUzNEwxNzIuMDE1LDUyMC4zMzRaIiBzdHlsZT0iZmlsbDpyZ2IoNyw3LDcpO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgICAgICA8cGF0aCBkPSJNMjM1LjgxNSw1MjMuOTM0QzI0OC44MTUsNTIzLjkzNCAyNjEuNTE1LDUxNS43MzQgMjYxLjUxNSw0OTcuOTM0QzI2MS41MTUsNDgzLjEzNCAyNTEuNTE1LDQ3Mi44MzQgMjM2LjYxNSw0NzIuODM0QzIyMC44MTUsNDcyLjgzNCAyMTAuNDE1LDQ4Mi45MzQgMjEwLjQxNSw0OTguNzM0QzIxMC40MTUsNTE0LjUzNCAyMjEuNDE1LDUyMy45MzQgMjM1LjcxNSw1MjMuOTM0TDIzNS44MTUsNTIzLjkzNFpNMjM2LjAxNSw1MTMuMDM0QzIyOS42MTUsNTEzLjAzNCAyMjYuMTE1LDUwNi43MzQgMjI2LjExNSw0OTguNDM0QzIyNi4xMTUsNDkxLjEzNCAyMjguOTE1LDQ4My43MzQgMjM2LjExNSw0ODMuNzM0QzI0My4wMTUsNDgzLjczNCAyNDUuODE1LDQ5MS4xMzQgMjQ1LjgxNSw0OTguMzM0QzI0NS44MTUsNTA3LjEzNCAyNDIuMTE1LDUxMy4wMzQgMjM2LjExNSw1MTMuMDM0TDIzNi4wMTUsNTEzLjAzNFoiIHN0eWxlPSJmaWxsOnJnYig3LDcsNyk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yNjUuOTE1LDUyMi44MzRMMjgxLjExNSw1MjIuODM0TDI4MS4xMTUsNDk0LjYzNEMyODEuMTE1LDQ5My4yMzQgMjgxLjIxNSw0OTEuODM0IDI4MS42MTUsNDkwLjgzNEMyODIuNzE1LDQ4OC4wMzQgMjg1LjIxNSw0ODUuMTM0IDI4OS40MTUsNDg1LjEzNEMyOTQuOTE1LDQ4NS4xMzQgMjk3LjExNSw0ODkuNDM0IDI5Ny4xMTUsNDk1LjczNEwyOTcuMTE1LDUyMi44MzRMMzEyLjMxNSw1MjIuODM0TDMxMi4zMTUsNDkzLjkzNEMzMTIuMzE1LDQ3OS41MzQgMzA0LjgxNSw0NzIuODM0IDI5NC44MTUsNDcyLjgzNEMyODYuNjE1LDQ3Mi44MzQgMjgxLjcxNSw0NzcuNTM0IDI3OS43MTUsNDgwLjczNEwyNzkuNDE1LDQ4MC43MzRMMjc4LjcxNSw0NzMuOTM0TDI2NS41MTUsNDczLjkzNEMyNjUuNzE1LDQ3OC4zMzQgMjY1LjkxNSw0ODMuNDM0IDI2NS45MTUsNDg5LjUzNEwyNjUuOTE1LDUyMi44MzRaIiBzdHlsZT0iZmlsbDpyZ2IoNyw3LDcpO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgICAgICA8cGF0aCBkPSJNMzYwLjIxNSw0OTMuOTM0QzM2MC4yMTUsNDgyLjQzNCAzNTUuMTE1LDQ3Mi44MzQgMzM4LjgxNSw0NzIuODM0QzMyOS45MTUsNDcyLjgzNCAzMjMuMjE1LDQ3NS4zMzQgMzE5LjgxNSw0NzcuMjM0TDMyMi42MTUsNDg2LjkzNEMzMjUuODE1LDQ4NS4wMzQgMzMxLjExNSw0ODMuMzM0IDMzNi4xMTUsNDgzLjMzNEMzNDMuNjE1LDQ4My4zMzQgMzQ1LjAxNSw0ODcuMDM0IDM0NS4wMTUsNDg5LjYzNEwzNDUuMDE1LDQ5MC4yMzRDMzI3LjcxNSw0OTAuMjM0IDMxNi4zMTUsNDk2LjIzNCAzMTYuMzE1LDUwOC45MzRDMzE2LjMxNSw1MTYuNzM0IDMyMi4yMTUsNTIzLjkzNCAzMzIuMTE1LDUyMy45MzRDMzM3LjkxNSw1MjMuOTM0IDM0Mi45MTUsNTIxLjgzNCAzNDYuMTE1LDUxNy45MzRMMzQ2LjQxNSw1MTcuOTM0TDM0Ny4zMTUsNTIyLjgzNEwzNjEuMDE1LDUyMi44MzRDMzYwLjQxNSw1MjAuMTM0IDM2MC4yMTUsNTE1LjYzNCAzNjAuMjE1LDUxMS4wMzRMMzYwLjIxNSw0OTMuOTM0Wk0zNDUuNTE1LDUwNS4wMzRDMzQ1LjUxNSw1MDUuOTM0IDM0NS40MTUsNTA2LjgzNCAzNDUuMjE1LDUwNy42MzRDMzQ0LjIxNSw1MTAuNzM0IDM0MS4wMTUsNTEzLjIzNCAzMzcuMzE1LDUxMy4yMzRDMzMzLjkxNSw1MTMuMjM0IDMzMS4zMTUsNTExLjMzNCAzMzEuMzE1LDUwNy40MzRDMzMxLjMxNSw1MDEuNjM0IDMzNy41MTUsNDk5LjczNCAzNDUuNTE1LDQ5OS43MzRMMzQ1LjUxNSw1MDUuMDM0WiIgc3R5bGU9ImZpbGw6cmdiKDcsNyw3KTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICAgICAgPHBhdGggZD0iTTM2Ny4zMTUsNTIyLjgzNEwzODIuNTE1LDUyMi44MzRMMzgyLjUxNSw0OTguMTM0QzM4Mi41MTUsNDk2LjgzNCAzODIuNjE1LDQ5NS43MzQgMzgyLjgxNSw0OTQuNzM0QzM4My44MTUsNDg5LjkzNCAzODcuNjE1LDQ4Ny4wMzQgMzkzLjIxNSw0ODcuMDM0QzM5NC45MTUsNDg3LjAzNCAzOTYuMTE1LDQ4Ny4yMzQgMzk3LjMxNSw0ODcuNDM0TDM5Ny4zMTUsNDczLjEzNEMzOTYuMjE1LDQ3Mi45MzQgMzk1LjUxNSw0NzIuODM0IDM5NC4xMTUsNDcyLjgzNEMzODkuMzE1LDQ3Mi44MzQgMzgzLjQxNSw0NzUuODM0IDM4MC45MTUsNDgzLjAzNEwzODAuNTE1LDQ4My4wMzRMMzc5LjkxNSw0NzMuOTM0TDM2Ni45MTUsNDczLjkzNEMzNjcuMjE1LDQ3OC4xMzQgMzY3LjMxNSw0ODIuODM0IDM2Ny4zMTUsNDkwLjAzNEwzNjcuMzE1LDUyMi44MzRaIiBzdHlsZT0iZmlsbDpyZ2IoNyw3LDcpO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgwLjI0LDAsMCwwLjI0LC0yLjk0MTQxLDUuNjU2NjgpIj4KICAgICAgICAgICAgPHBhdGggZD0iTTUzOS44MjgsNDEzLjE3TDUzMS4wMjgsNDEzLjE3TDUzMS4wMjgsNDQyLjc3QzUzMS4wMjgsNDQ0LjQ3IDUzMC43MjgsNDQ2LjA3IDUzMC4yMjgsNDQ3LjI3QzUyOC42MjgsNDUxLjI3IDUyNC41MjgsNDU1LjM3IDUxOC42MjgsNDU1LjM3QzUxMC43MjgsNDU1LjM3IDUwNy44MjgsNDQ5LjA3IDUwNy44MjgsNDM5Ljg3TDUwNy44MjgsNDEzLjE3TDQ5OS4wMjgsNDEzLjE3TDQ5OS4wMjgsNDQxLjQ3QzQ5OS4wMjgsNDU4LjM3IDUwOC4xMjgsNDYyLjY3IDUxNS43MjgsNDYyLjY3QzUyNC4zMjgsNDYyLjY3IDUyOS41MjgsNDU3LjU3IDUzMS43MjgsNDUzLjY3TDUzMS45MjgsNDUzLjY3TDUzMi40MjgsNDYxLjU3TDU0MC4yMjgsNDYxLjU3QzUzOS45MjgsNDU3Ljc3IDUzOS44MjgsNDUzLjM3IDUzOS44MjgsNDQ4LjI3TDUzOS44MjgsNDEzLjE3WiIgc3R5bGU9ImZpbGw6cmdiKDcsNyw3KTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICAgICAgPHBhdGggZD0iTTU0OS40MjgsNDQ5LjA3QzU0OS40MjgsNDUzLjM3IDU0OS4zMjgsNDU4LjI3IDU0OS4wMjgsNDYxLjU3TDU1Ni42MjgsNDYxLjU3TDU1Ny4xMjgsNDUzLjU3TDU1Ny4zMjgsNDUzLjU3QzU2MS4wMjgsNDU5Ljk3IDU2Ni41MjgsNDYyLjY3IDU3My41MjgsNDYyLjY3QzU4NC4zMjgsNDYyLjY3IDU5NS4zMjgsNDU0LjA3IDU5NS4zMjgsNDM2LjY3QzU5NS4zMjgsNDIyLjA3IDU4Ni45MjgsNDEyLjA3IDU3NC45MjgsNDEyLjA3QzU2Ny4xMjgsNDEyLjA3IDU2MS41MjgsNDE1LjQ3IDU1OC40MjgsNDIwLjg3TDU1OC4yMjgsNDIwLjg3TDU1OC4yMjgsMzkwLjU3TDU0OS40MjgsMzkwLjU3TDU0OS40MjgsNDQ5LjA3Wk01NTguMjI4LDQzMy40N0M1NTguMjI4LDQzMi4wNyA1NTguNDI4LDQzMC44NyA1NTguNzI4LDQyOS43N0M1NjAuNDI4LDQyMy4xNyA1NjYuMDI4LDQxOC45NyA1NzIuMDI4LDQxOC45N0M1ODEuNDI4LDQxOC45NyA1ODYuNDI4LDQyNy4yNyA1ODYuNDI4LDQzNy4wN0M1ODYuNDI4LDQ0OC4xNyA1ODEuMDI4LDQ1NS42NyA1NzEuNzI4LDQ1NS42N0M1NjUuNDI4LDQ1NS42NyA1NjAuMjI4LDQ1MS40NyA1NTguNTI4LDQ0NS4zN0M1NTguMzI4LDQ0NC4zNyA1NTguMjI4LDQ0My4yNyA1NTguMjI4LDQ0Mi4xN0w1NTguMjI4LDQzMy40N1oiIHN0eWxlPSJmaWxsOnJnYig3LDcsNyk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik02NDAuMjI4LDQzOC45N0M2NDAuNDI4LDQzNy45NyA2NDAuNTI4LDQzNi42NyA2NDAuNTI4LDQzNC44N0M2NDAuNTI4LDQyNS45NyA2MzYuNDI4LDQxMi4wNyA2MjAuNjI4LDQxMi4wN0M2MDYuNTI4LDQxMi4wNyA1OTcuODI4LDQyMy41NyA1OTcuODI4LDQzOC4xN0M1OTcuODI4LDQ1Mi42NyA2MDYuODI4LDQ2Mi41NyA2MjEuNjI4LDQ2Mi41N0M2MjkuMzI4LDQ2Mi41NyA2MzQuNzI4LDQ2MC44NyA2MzcuODI4LDQ1OS40N0w2MzYuMjI4LDQ1My4xN0M2MzMuMDI4LDQ1NC41NyA2MjkuMTI4LDQ1NS42NyA2MjIuODI4LDQ1NS42N0M2MTQuMDI4LDQ1NS42NyA2MDYuNTI4LDQ1MC43NyA2MDYuMzI4LDQzOC45N0w2NDAuMjI4LDQzOC45N1pNNjA2LjQyOCw0MzIuNjdDNjA3LjEyOCw0MjYuNTcgNjEwLjkyOCw0MTguMzcgNjE5LjkyOCw0MTguMzdDNjI5LjcyOCw0MTguMzcgNjMyLjEyOCw0MjcuMDcgNjMyLjAyOCw0MzIuNjdMNjA2LjQyOCw0MzIuNjdaIiBzdHlsZT0iZmlsbDpyZ2IoNyw3LDcpO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+Cg==
    marketplace.cloud.google.com/deploy-info: '{"partner_id": "click-to-deploy-containers", "product_id": "sonarqube", "partner_name": "Google Click to Deploy"}'
  labels:
    app.kubernetes.io/name: "{{ .Release.Name }}"
spec:
  type: SonarQube
  version: '7.6'
  description: |-
    SonarQube is an open source platform to perform automatic reviews with static analysis of code to detect bugs,
    code smells and security vulnerabilities on 25+ programming languages including Java, C#, JavaScript, TypeScript,
    C/C++, COBOL and more. SonarQube is the only product on the market that supports a leak approach as a practice to code quality.

    # Support
    Google does not offer support for this solution. However, community support is available on
    Additional community support is available on [community forums](https://www.sonarqube.org/community/).
  info:
  - name: SonarQube IP address
    type: Reference
    valueFrom:
      serviceRef:
        name: {{ .Release.Name }}-sonarqube-svc
  - name: Temporary password for user postgres
    type: Reference
    valueFrom:
      secretKeyRef:
        key: password
        name: {{ .Release.Name }}-secret
  - name: Application Namespace
    value: {{ .Release.Namespace }}
  maintainers:
  - name: Google Click to Deploy
    url: https://cloud.google.com/solutions/#click-to-deploy
  links:
  - description: 'User Guide: Google Click to Deploy PostgreSQL'
    url: https://github.com/GoogleCloudPlatform/click-to-deploy/blob/master/k8s/sonarqube/README.md
  - description: 'PostgreSQL: Getting Started'
    url: https://github.com/GoogleCloudPlatform/sonarqube-docker/blob/master/README.md
  selector:
    matchLabels:
      app.kubernetes.io/name: "{{ .Release.Name }}"
  componentKinds:
  - group: apps/v1beta2
    kind: Deployment
  - group: v1
    kind: PersistentVolumeClaim
  - group: v1
    kind: Secret
  - group: v1
    kind: Service
  - group: v1
    kind: ServiceAccount
  notes: |-
    # Access PostgreSQL

    Get the external IP of the PostgreSQL service:

    ```
    SERVICE_IP=$(kubectl get \
      --namespace {{ .Release.Namespace }} \
      svc {{ .Release.Name }}-postgresql-svc \
      -o jsonpath='{.status.loadBalancer.ingress[0].ip}')

    export PGPASSWORD=$(kubectl get secret "{{ .Release.Name }}-secret" \
      --output=jsonpath='{.data.password}' | base64 -d)

    psql -U postgres -h $SERVICE_IP
    ```

    Note that it might take some time for the external IP to be provisioned.

